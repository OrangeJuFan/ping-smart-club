# Spring Boot 配置文件说明

## 当前配置文件结构

你的项目中有以下配置文件：

1. **application.yml** - 主配置文件（默认加载）
2. **application-dev.yml** - 开发环境配置
3. **application-prod.yml** - 生产环境配置

## 配置文件加载规则

Spring Boot 会按以下顺序加载配置：

1. **application.yml** - 总是会被加载（基础配置）
2. **application-{profile}.yml** - 根据激活的 profile 加载（会覆盖主配置中的相同项）

## 当前使用的配置文件

**默认情况下**，如果没有指定 profile，Spring Boot 只会加载：
- ✅ `application.yml`（主配置文件）

**如果指定了 profile**，会加载：
- ✅ `application.yml`（基础配置）
- ✅ `application-{profile}.yml`（环境特定配置，会覆盖主配置）

## 如何指定使用哪个配置文件

### 方法 1：在 application.yml 中指定（推荐用于开发）

在 `application.yml` 文件开头添加：

```yaml
spring:
  profiles:
    active: dev  # 指定使用 dev 环境
```

或者：

```yaml
spring:
  profiles:
    active: prod  # 指定使用 prod 环境
```

### 方法 2：通过启动参数指定（推荐用于生产）

#### 方式 A：使用 Maven 启动
```bash
mvn spring-boot:run -Dspring-boot.run.arguments=--spring.profiles.active=dev
```

#### 方式 B：使用 Java 命令启动
```bash
java -jar your-app.jar --spring.profiles.active=prod
```

#### 方式 C：在 IDE 中配置（IDEA/Eclipse）

**IDEA 配置步骤：**
1. 右键点击 `PingSmartClubWebBootApplication.java`
2. 选择 `Run` → `Edit Configurations...`
3. 在 `VM options` 或 `Program arguments` 中添加：
   ```
   --spring.profiles.active=dev
   ```
4. 或者在 `Environment variables` 中添加：
   ```
   SPRING_PROFILES_ACTIVE=dev
   ```

### 方法 3：通过环境变量指定

```bash
# Linux/Mac
export SPRING_PROFILES_ACTIVE=prod

# Windows
set SPRING_PROFILES_ACTIVE=prod
```

### 方法 4：在代码中指定（不推荐，仅用于测试）

```java
@SpringBootApplication
public class PingSmartClubWebBootApplication {
    public static void main(String[] args) {
        SpringApplication app = new SpringApplication(PingSmartClubWebBootApplication.class);
        app.setDefaultProperties(Collections.singletonMap("spring.profiles.active", "dev"));
        app.run(args);
    }
}
```

## 配置文件优先级

当同时存在多个配置时，优先级从高到低：

1. **命令行参数**（最高优先级）
2. **环境变量**
3. **application-{profile}.yml**
4. **application.yml**（最低优先级）

## 查看当前激活的 Profile

启动应用后，在控制台日志中可以看到：

```
The following profiles are active: dev
```

或者访问：
```
http://localhost:8080/api/actuator/env
```
（需要添加 Actuator 依赖）

## 推荐配置方式

### 开发环境
在 `application.yml` 中设置：
```yaml
spring:
  profiles:
    active: dev
```

### 生产环境
**不要**在 `application.yml` 中硬编码，而是通过启动参数或环境变量指定：
```bash
java -jar app.jar --spring.profiles.active=prod
```

## 配置文件内容说明

### application.yml（主配置）
- 包含所有环境的公共配置
- 数据库连接、MyBatis-Plus、Swagger 等通用配置

### application-dev.yml（开发环境）
- 覆盖主配置中的数据库连接（使用 dev 数据库）
- 日志级别设置为 DEBUG

### application-prod.yml（生产环境）
- 使用环境变量注入敏感信息（数据库密码等）
- 日志级别设置为 INFO
- 使用 SSL 连接数据库

## 示例：检查当前使用的配置

启动应用后，查看日志输出，可以看到加载了哪些配置文件：

```
Loading config file: classpath:application.yml
Loading config file: classpath:application-dev.yml  # 如果激活了 dev profile
```

